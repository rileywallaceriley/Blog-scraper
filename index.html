<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FEED — Hip Hop News Scraper</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Space+Mono:wght@400;700&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
html, body { background-color: #0a0a0a; color: #f0ece4; font-family: 'DM Sans', sans-serif; min-height: 100vh; }

header {
background-color: #0a0a0a;
border-bottom: 1px solid #2a2a2a;
padding: 0 20px;
display: flex;
align-items: center;
height: 60px;
position: sticky;
top: 0;
z-index: 100;
}
.logo { font-family: ‘Bebas Neue’, sans-serif; font-size: 1.8rem; letter-spacing: 4px; color: #f0ece4; }
.logo span { color: #ff3c00; }
.logo-sub { font-family: ‘Space Mono’, monospace; font-size: 0.55rem; color: #444444; letter-spacing: 3px; text-transform: uppercase; margin-left: 14px; margin-top: 6px; }

.ticker { background-color: #ff3c00; padding: 5px 0; overflow: hidden; white-space: nowrap; }
.ticker-inner {
display: inline-block; animation: ticker 40s linear infinite;
font-family: ‘Space Mono’, monospace; font-size: 0.65rem; letter-spacing: 3px; color: #000000; font-weight: 700;
}
@keyframes ticker { from { transform: translateX(100vw); } to { transform: translateX(-100%); } }

.container { max-width: 1200px; margin: 0 auto; padding: 24px 20px; }

.controls { display: flex; flex-direction: column; gap: 14px; margin-bottom: 20px; }
.source-chips { display: flex; gap: 8px; flex-wrap: wrap; }
.chip {
font-family: ‘Space Mono’, monospace; font-size: 0.6rem; letter-spacing: 1px;
padding: 7px 14px; border: 1px solid #2a2a2a; border-radius: 2px; cursor: pointer;
background-color: #0a0a0a; color: #666666; text-transform: uppercase; transition: all 0.15s;
}
.chip.active { border-color: #ff3c00; color: #ff3c00; background-color: #1a0a05; }
.chip.scrape { border-style: dashed; }

.controls-row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }

.btn {
font-family: ‘Bebas Neue’, sans-serif; letter-spacing: 3px; font-size: 1rem;
padding: 10px 24px; cursor: pointer; border: none; border-radius: 2px;
transition: all 0.15s; white-space: nowrap;
}
.btn-primary { background-color: #ff3c00; color: #ffffff; }
.btn-primary:hover { background-color: #ff5500; }
.btn-primary:disabled { background-color: #2a2a2a; color: #444444; cursor: not-allowed; }

.badge {
font-family: ‘Space Mono’, monospace; font-size: 0.58rem; color: #00ff88; letter-spacing: 1px;
border: 1px solid #00ff88; padding: 6px 10px; border-radius: 2px; white-space: nowrap;
}

.debug-log {
background-color: #111111; border: 1px solid #2a2a2a; border-radius: 2px;
padding: 10px 14px; margin-bottom: 16px; font-family: ‘Space Mono’, monospace;
font-size: 0.6rem; color: #666666; letter-spacing: 1px; max-height: 70px; overflow-y: auto; display: none;
}
.debug-log.visible { display: block; }
.debug-log p { line-height: 1.9; }
.debug-log p.ok { color: #00ff88; }
.debug-log p.err { color: #ff3c00; }
.debug-log p.warn { color: #ffd600; }

/* Stories grid */
.stories-grid {
display: grid; grid-template-columns: 1fr; gap: 1px;
background-color: #2a2a2a; border: 1px solid #2a2a2a;
}
@media(min-width: 700px) { .stories-grid { grid-template-columns: repeat(2, 1fr); } }
@media(min-width: 1100px) { .stories-grid { grid-template-columns: repeat(3, 1fr); } }

.story-card {
background-color: #0a0a0a; padding: 22px; display: flex; flex-direction: column;
gap: 12px; position: relative; overflow: hidden; transition: background-color 0.2s;
}
.story-card:hover { background-color: #111111; }
.story-card::before {
content: ‘’; position: absolute; top: 0; left: 0;
width: 3px; height: 0; background-color: #ff3c00; transition: height 0.3s;
}
.story-card:hover::before { height: 100%; }

.card-meta { display: flex; justify-content: space-between; align-items: center; }
.source-tag {
font-family: ‘Space Mono’, monospace; font-size: 0.55rem; letter-spacing: 2px;
color: #ff3c00; text-transform: uppercase; background-color: #1a0a05; padding: 3px 7px; border-radius: 1px;
}
.source-tag.scraped { background-color: transparent; border: 1px dashed #ff3c00; }
.pub-date { font-family: ‘Space Mono’, monospace; font-size: 0.55rem; color: #00ff88; }
.pub-date.unknown { color: #444444; }

.card-title {
font-family: ‘Bebas Neue’, sans-serif; font-size: 1.4rem; letter-spacing: 1px;
line-height: 1.1; color: #f0ece4;
}

.card-body {
font-size: 0.82rem; line-height: 1.65; color: #999999;
display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden;
}

/* Copy block — shown after clicking COPY FOR GPT */
.copy-block {
background-color: #0f0f0f; border: 1px solid #2a2a2a; border-radius: 2px;
padding: 14px; display: none; flex-direction: column; gap: 10px;
}
.copy-block.open { display: flex; }
.copy-text {
font-family: ‘Space Mono’, monospace; font-size: 0.68rem; line-height: 1.7;
color: #cccccc; white-space: pre-wrap; word-break: break-word;
max-height: 200px; overflow-y: auto;
scrollbar-width: thin; scrollbar-color: #2a2a2a #0f0f0f;
}
.copy-actions { display: flex; gap: 8px; align-items: center; }
.copy-confirm {
font-family: ‘Space Mono’, monospace; font-size: 0.58rem; color: #00ff88;
letter-spacing: 1px; opacity: 0; transition: opacity 0.3s;
}
.copy-confirm.show { opacity: 1; }

.card-actions { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
.btn-sm {
font-family: ‘Space Mono’, monospace; font-size: 0.58rem; letter-spacing: 1px;
padding: 6px 12px; border: 1px solid #2a2a2a; border-radius: 2px; cursor: pointer;
background: none; color: #666666; text-transform: uppercase; transition: all 0.15s;
}
.btn-sm:hover { border-color: #ff3c00; color: #ff3c00; }
.btn-sm.primary { border-color: #ff3c00; color: #ff3c00; }
.btn-sm.primary:hover { background-color: #ff3c00; color: #ffffff; }
.btn-sm.blue { border-color: #3a86ff; color: #3a86ff; }
.btn-sm.blue:hover { background-color: #3a86ff; color: #ffffff; }
.btn-sm:disabled { border-color: #2a2a2a; color: #333333; cursor: not-allowed; }

.original-link {
font-family: ‘Space Mono’, monospace; font-size: 0.58rem; letter-spacing: 1px;
color: #444444; text-decoration: none; margin-left: auto; transition: color 0.15s;
}
.original-link:hover { color: #f0ece4; }

.spinner {
width: 14px; height: 14px; border: 2px solid #2a2a2a; border-top-color: #ff3c00;
border-radius: 50%; animation: spin 0.7s linear infinite; display: inline-block;
}
@keyframes spin { to { transform: rotate(360deg); } }

.status-msg {
grid-column: 1 / -1; padding: 60px 30px; text-align: center;
font-family: ‘Space Mono’, monospace; font-size: 0.75rem; color: #444444;
letter-spacing: 2px; background-color: #0a0a0a;
}
.big-status {
font-family: ‘Bebas Neue’, sans-serif; font-size: 3.5rem; color: #1a1a1a;
letter-spacing: 8px; display: block; margin-bottom: 12px;
}

/* Story count */
.story-count {
font-family: ‘Space Mono’, monospace; font-size: 0.6rem; color: #444444;
letter-spacing: 2px; margin-bottom: 12px;
}
.story-count span { color: #ff3c00; }

.toast {
position: fixed; bottom: 24px; right: 20px; left: 20px;
background-color: #111111; border: 1px solid #2a2a2a; border-left: 3px solid #00ff88;
padding: 12px 16px; font-family: ‘Space Mono’, monospace; font-size: 0.65rem;
letter-spacing: 1px; color: #f0ece4; border-radius: 2px;
transform: translateY(120px); opacity: 0; transition: all 0.3s ease; z-index: 1000;
}
@media(min-width: 500px) { .toast { left: auto; width: 300px; } }
.toast.show { transform: translateY(0); opacity: 1; }
</style>

</head>
<body>

<header>
  <div class="logo">FEED<span>.</span></div>
  <span class="logo-sub">Hip Hop News Scraper</span>
</header>

<div class="ticker">
  <span class="ticker-inner">★ FEED — HIP HOP NEWS SCRAPER ★ 48H FRESH ONLY ★ COPY FOR GPT ★ FEED — HIP HOP NEWS SCRAPER ★ 48H FRESH ONLY ★ COPY FOR GPT ★ FEED — HIP HOP NEWS SCRAPER ★</span>
</div>

<div class="container">
  <div class="controls">
    <div class="source-chips" id="sourceChips">
      <button class="chip active"        data-type="rss"    data-name="AllHipHop"    data-url="https://allhiphop.com/feed">AllHipHop</button>
      <button class="chip active"        data-type="rss"    data-name="The Source"   data-url="https://thesource.com/feed">The Source</button>
      <button class="chip active"        data-type="rss"    data-name="Complex"      data-url="https://www.complex.com/music/rss">Complex</button>
      <button class="chip"               data-type="rss"    data-name="TMZ HipHop"   data-url="https://www.tmz.com/category/hip-hop/rss.xml">TMZ HipHop</button>
      <button class="chip"               data-type="rss"    data-name="XXL"          data-url="https://xxlmag.com/feed">XXL</button>
      <button class="chip"               data-type="rss"    data-name="Pitchfork"    data-url="https://pitchfork.com/feed/feed-news/rss">Pitchfork</button>
      <button class="chip scrape active" data-type="scrape" data-name="HipHopDX"     data-url="https://hiphopdx.com/news/" data-selector="article a, .article-title a, h2 a, h3 a">HipHopDX</button>
      <button class="chip scrape active" data-type="scrape" data-name="HotNewHipHop" data-url="https://www.hotnewhiphop.com/articles/news" data-selector="article a, .news-list a, h2 a, h3 a, a[href*='/news/']">HotNewHipHop</button>
      <button class="chip scrape active" data-type="scrape" data-name="Exclaim"      data-url="https://exclaim.ca/music/news" data-selector="article a, .article-title a, h2 a, h3 a, a[href*='/music/article/']">Exclaim</button>
    </div>
    <div class="controls-row">
      <button class="btn btn-primary" id="fetchBtn">FETCH STORIES</button>
      <span class="badge">&#9679; 48H FRESH ONLY</span>
    </div>
  </div>

  <div class="debug-log" id="debugLog"></div>
  <div class="story-count" id="storyCount" style="display:none">Showing <span id="countNum">0</span> stories from the last 48 hours</div>

  <div class="stories-grid" id="storiesGrid">
    <div class="status-msg">
      <span class="big-status">FEED</span>
      Select your sources and hit FETCH STORIES
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
var stories = [];

var PROXIES = [
  function(url) { return 'https://corsproxy.io/?' + encodeURIComponent(url); },
  function(url) { return 'https://api.allorigins.win/get?url=' + encodeURIComponent(url); },
  function(url) { return 'https://api.codetabs.com/v1/proxy?quest=' + encodeURIComponent(url); }
];

document.querySelectorAll('.chip').forEach(function(c) {
  c.addEventListener('click', function() { c.classList.toggle('active'); });
});

function log(msg, type) {
  var el = document.getElementById('debugLog');
  el.classList.add('visible');
  var p = document.createElement('p');
  if (type) p.className = type;
  p.textContent = '› ' + msg;
  el.appendChild(p);
  el.scrollTop = el.scrollHeight;
}

async function fetchRaw(url) {
  for (var i = 0; i < PROXIES.length; i++) {
    try {
      log('Proxy ' + (i+1) + ' → ' + new URL(url).hostname);
      var res = await fetch(PROXIES[i](url), { signal: AbortSignal.timeout(10000) });
      if (!res.ok) throw new Error('HTTP ' + res.status);
      var text = await res.text();
      try { var j = JSON.parse(text); if (j.contents) return j.contents; } catch(e) {}
      return text;
    } catch(e) {
      log('Proxy ' + (i+1) + ' failed: ' + e.message, 'err');
    }
  }
  throw new Error('All proxies exhausted');
}

var MAX_AGE_MS = 48 * 60 * 60 * 1000;

function isWithin48Hours(pubDateStr) {
  if (!pubDateStr) return null;
  var d = new Date(pubDateStr);
  if (isNaN(d.getTime())) return null;
  return (Date.now() - d.getTime()) <= MAX_AGE_MS;
}

function ageLabel(pubDateStr) {
  if (!pubDateStr) return null;
  var d = new Date(pubDateStr);
  if (isNaN(d.getTime())) return null;
  var diffMs = Date.now() - d.getTime();
  var diffH = Math.floor(diffMs / 3600000);
  var diffM = Math.floor(diffMs / 60000);
  if (diffM < 60) return diffM + 'm ago';
  if (diffH < 24) return diffH + 'h ago';
  return Math.floor(diffH / 24) + 'd ' + (diffH % 24) + 'h ago';
}

function parseRSS(xmlStr, sourceName) {
  var parser = new DOMParser();
  var xml = parser.parseFromString(xmlStr, 'text/xml');
  var results = [];
  var skipped = 0;
  xml.querySelectorAll('item').forEach(function(item, i) {
    if (i >= 20) return;
    function g(tag) { return ((item.querySelector(tag) || {}).textContent || '').replace(/<!\[CDATA\[|\]\]>/g,'').trim(); }
    var title   = g('title') || 'Untitled';
    var link    = g('link') || '#';
    var desc    = g('description');
    var pubDate = g('pubDate');
    var content = g('content\\:encoded') || g('encoded') || '';
    var fresh = isWithin48Hours(pubDate);
    if (fresh === false) { skipped++; return; }
    var div = document.createElement('div');
    div.innerHTML = content || desc;
    var clean = (div.textContent || '').replace(/\s+/g,' ').trim().slice(0, 2000);
    if (!title || title === 'Untitled') return;
    if (results.length >= 8) return;
    results.push({ title: title, link: link, body: clean, pubDate: pubDate, source: sourceName, scraped: false });
  });
  if (skipped > 0) log(sourceName + ': dropped ' + skipped + ' older than 48h', 'warn');
  return results;
}

function scrapeHTML(htmlStr, sourceName, pageUrl, selectorStr) {
  var parser = new DOMParser();
  var doc = parser.parseFromString(htmlStr, 'text/html');
  var base = new URL(pageUrl);
  var seen = {};
  var results = [];
  var selectors = selectorStr.split(',').map(function(s) { return s.trim(); });

  selectors.forEach(function(sel) {
    doc.querySelectorAll(sel).forEach(function(el) {
      try {
        var anchor = el.tagName === 'A' ? el : el.querySelector('a');
        if (!anchor) return;
        var href = anchor.getAttribute('href') || '';
        if (!href || href === '#' || href.startsWith('javascript')) return;
        var absUrl = href.startsWith('http') ? href : new URL(href, base).href;
        if (seen[absUrl]) return;
        var linkHost = new URL(absUrl).hostname;
        if (linkHost !== base.hostname) return;
        var text = (anchor.textContent || '').replace(/\s+/g,' ').trim();
        if (text.length < 20 || text.length > 300) return;
        if (/^(home|news|music|videos?|photos?|about|contact|search|login|subscribe|tag|category|more|see all)/i.test(text)) return;
        seen[absUrl] = true;
        var parent = anchor.closest('article') || anchor.closest('.post') || anchor.closest('li') || anchor.parentElement;
        var descEl = parent ? parent.querySelector('p, .excerpt, .description, .summary') : null;
        var desc = descEl ? descEl.textContent.replace(/\s+/g,' ').trim().slice(0,800) : '';
        results.push({ title: text, link: absUrl, body: desc, pubDate: '', source: sourceName, scraped: true });
      } catch(e) {}
    });
  });

  var final = [];
  var seen2 = {};
  results.forEach(function(r) {
    var key = r.title.slice(0,40).toLowerCase();
    if (seen2[key]) return;
    seen2[key] = true;
    final.push(r);
  });
  return final.slice(0, 8);
}

async function fetchSource(chip) {
  var type = chip.dataset.type;
  var name = chip.dataset.name;
  var url  = chip.dataset.url;
  try {
    var raw = await fetchRaw(url);
    if (type === 'rss') {
      var parsed = parseRSS(raw, name);
      log(name + ': ' + parsed.length + ' stories', parsed.length ? 'ok' : 'warn');
      return parsed;
    } else {
      var sel = chip.dataset.selector || 'article a, h2 a, h3 a';
      var scraped = scrapeHTML(raw, name, url, sel);
      log(name + ': ' + scraped.length + ' stories (scraped)', scraped.length ? 'ok' : 'warn');
      return scraped;
    }
  } catch(e) {
    log(name + ': FAILED — ' + e.message, 'err');
    return [];
  }
}

document.getElementById('fetchBtn').addEventListener('click', async function() {
  var active = Array.from(document.querySelectorAll('.chip.active'));
  if (!active.length) { showToast('Select at least one source!'); return; }

  var btn = document.getElementById('fetchBtn');
  btn.disabled = true; btn.textContent = 'FETCHING...';
  document.getElementById('debugLog').innerHTML = '';
  document.getElementById('storiesGrid').innerHTML = '<div class="status-msg"><span class="spinner"></span><br><br>Pulling stories from the culture...</div>';
  stories = [];

  for (var i = 0; i < active.length; i++) {
    var found = await fetchSource(active[i]);
    stories = stories.concat(found);
  }

  stories.sort(function() { return Math.random() - 0.5; });
  btn.disabled = false; btn.textContent = 'FETCH STORIES';

  if (!stories.length) {
    document.getElementById('storiesGrid').innerHTML = '<div class="status-msg"><span class="big-status">404</span>No stories found. Check the log above.</div>';
    document.getElementById('storyCount').style.display = 'none';
    return;
  }

  document.getElementById('countNum').textContent = stories.length;
  document.getElementById('storyCount').style.display = 'block';
  renderStories();
});

function renderStories() {
  var grid = document.getElementById('storiesGrid');
  grid.innerHTML = '';
  stories.forEach(function(s, i) { grid.appendChild(createCard(s, i)); });
}

function buildCopyText(story) {
  var lines = [];
  lines.push('SOURCE: ' + story.source);
  lines.push('URL: ' + story.link);
  if (story.pubDate) lines.push('DATE: ' + new Date(story.pubDate).toLocaleString());
  lines.push('');
  lines.push('HEADLINE: ' + story.title);
  lines.push('');
  if (story.body) lines.push(story.body);
  return lines.join('\n');
}

function createCard(story, idx) {
  var card = document.createElement('div');
  card.className = 'story-card';
  card.id = 'card-' + idx;

  var age = ageLabel(story.pubDate);
  var tagClass = 'source-tag' + (story.scraped ? ' scraped' : '');
  var dateClass = age ? 'pub-date' : 'pub-date unknown';
  var dateText = age || 'date unknown';

  card.innerHTML =
    '<div class="card-meta">' +
      '<span class="' + tagClass + '">' + story.source + '</span>' +
      '<span class="' + dateClass + '">' + dateText + '</span>' +
    '</div>' +
    '<div class="card-title">' + story.title + '</div>' +
    (story.body ? '<div class="card-body">' + story.body.slice(0, 300) + '...</div>' : '') +
    '<div class="copy-block" id="copyblock-' + idx + '">' +
      '<div class="copy-text" id="copytext-' + idx + '"></div>' +
      '<div class="copy-actions">' +
        '<button class="btn-sm blue" onclick="doCopy(' + idx + ')">COPY TO CLIPBOARD</button>' +
        '<span class="copy-confirm" id="copyconfirm-' + idx + '">✓ Copied!</span>' +
      '</div>' +
    '</div>' +
    '<div class="card-actions">' +
      '<button class="btn-sm primary" id="copybtn-' + idx + '" onclick="toggleCopyBlock(' + idx + ')">COPY FOR GPT</button>' +
      '<a class="original-link" href="' + story.link + '" target="_blank">&#8599; ORIGINAL</a>' +
    '</div>';

  // Set copy text safely
  var textEl = card.querySelector('#copytext-' + idx);
  if (textEl) textEl.textContent = buildCopyText(story);

  return card;
}

function toggleCopyBlock(idx) {
  var block = document.getElementById('copyblock-' + idx);
  var btn   = document.getElementById('copybtn-' + idx);
  if (!block) return;

  // If scraped and no body yet, try fetching article
  if (stories[idx].scraped && !stories[idx].body) {
    btn.textContent = 'LOADING...';
    btn.disabled = true;
    fetchRaw(stories[idx].link).then(function(raw) {
      var doc = new DOMParser().parseFromString(raw, 'text/html');
      var bodyEl = doc.querySelector('article, .article-body, .post-content, .entry-content, [class*="article"] p');
      if (bodyEl) {
        stories[idx].body = bodyEl.textContent.replace(/\s+/g,' ').trim().slice(0, 2000);
        var textEl = document.getElementById('copytext-' + idx);
        if (textEl) textEl.textContent = buildCopyText(stories[idx]);
        // Also update the preview
        var cardBody = document.querySelector('#card-' + idx + ' .card-body');
        if (cardBody) cardBody.textContent = stories[idx].body.slice(0, 300) + '...';
      }
      btn.disabled = false;
      btn.textContent = block.classList.contains('open') ? 'CLOSE' : 'COPY FOR GPT';
      block.classList.toggle('open');
      if (block.classList.contains('open')) btn.textContent = 'CLOSE';
    }).catch(function() {
      btn.disabled = false;
      btn.textContent = 'COPY FOR GPT';
      block.classList.toggle('open');
      if (block.classList.contains('open')) btn.textContent = 'CLOSE';
    });
    return;
  }

  block.classList.toggle('open');
  btn.textContent = block.classList.contains('open') ? 'CLOSE' : 'COPY FOR GPT';
}

function doCopy(idx) {
  var textEl = document.getElementById('copytext-' + idx);
  var confirm = document.getElementById('copyconfirm-' + idx);
  if (!textEl) return;
  navigator.clipboard.writeText(textEl.textContent).then(function() {
    if (confirm) {
      confirm.classList.add('show');
      setTimeout(function() { confirm.classList.remove('show'); }, 2000);
    }
    showToast('Copied to clipboard!');
  });
}

var toastTimeout;
function showToast(msg) {
  var t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  clearTimeout(toastTimeout);
  toastTimeout = setTimeout(function() { t.classList.remove('show'); }, 3000);
}
</script>

</body>
</html>